<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width = device-width, initial-scale = 1.0" />
    <title>QR Code Generierung für Online Check-In</title>
    <meta name="description" content="Beschreibungstext">
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css">
    <!-- script src="https://cdn.jsdelivr.net/npm/qrcode-generator@latest"></-->
    <!-- script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js" -->
    <script src="qrcode-generator.js"></script>
    <script src="html2pdf.bundle.min.js"></script>

    <style>
        #qrcode {
            background-color: #ffffff;
            color: #000e52;
            /* Hintergrundfarbe des QR-Codes */
            margin:30px;
        }
        .label {
            display: inline-block;
            width: 150px;
        }
    </style>
</head>

<body>

    <h1>Erzeugen Sie ihren QR-Code zum Online Check-in für Patienten</h1>

    <script>

        function isEmailValid(email) {
            // RFC 5322-konforme E-Mail-Adresse-Muster
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

            return emailRegex.test(email);
        }

        function generateQRCode() {
            var kim = document.getElementById("kimaddr").value;
            var addr = document.getElementById("paddress").value;
            var name = document.getElementById("pname").value;

            if (!isEmailValid(kim)) {
                alert(`Die E-Mail-Adresse "${kim}" ist ungültig.`);
                retutn;
            }

            var baseurl = "https://wwww.praxis-check-in.de?mail=";

            document.getElementById('addrcontrol').innerText = addr;
            document.getElementById('namecontrol').innerText = name;

            var qr = qrcode(8, 'M');
            qr.addData(baseurl+kim);
            qr.make();

            var canvas = document.getElementById("qrcode");
            var context = canvas.getContext("2d");

            var qrSize = qr.getModuleCount();
            var cellSize = 6;  // Größe jedes QR-Code-Zellen-Pixels

            canvas.width = qrSize * cellSize;
            canvas.height = qrSize * cellSize;

            for (var row = 0; row < qrSize; row++) {
                for (var col = 0; col < qrSize; col++) {
                    var isDark = qr.isDark(row, col);

                    // Zeichne den QR-Code mit Hintergrundfarbe und Zellenfarbe
                    context.fillStyle = isDark ? "#000e52" : "#ffffff";
                    context.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
                }
            }

            var icon = new Image();
            icon.src = "g.png";  // Pfad zu deinem Icon-Bild
            icon.onload = function () {
                var iconSize = qrSize * cellSize * 0.2;  // Größe des Icons im QR-Code (40% der Zellengröße)
                var iconX = (canvas.width - iconSize) / 2;
                var iconY = (canvas.height - iconSize) / 2;

                // Zeichne das Icon im Zentrum des QR-Codes
                context.drawImage(icon, iconX, iconY, iconSize, iconSize);
            };
        }

        function clearText() {
            document.getElementById('kimaddr').value = "";
            document.getElementById('pname').value = "";
            document.getElementById('paddress').value = "";
            document.getElementById('namecontrol').innerText = "...";
            document.getElementById('addrcontrol').innerText = "...";
            document.getElementById('qrcode').innerHTML = "";
        }

        function generatePDF() {

            const element = document.getElementById("ausdruck"); // HTML-Element, das in PDF konvertiert werden soll

            const opt = {
                filename: 'mein_pdf_dokument.pdf',
                margin: 10,
                jsPDF: { format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save();
        }
    </script>


    <p>Sichere Datenübermittlung ohne Gesundheitskarte: Mit dem Online Check-in können Patienten persönliche Daten wie
    ihre Krankenversichertennummer (KVNR) digital an Praxen senden. Damit lassen sich anschließend E-Rezepte ausstellen und
    elektronische Patientenakten befüllen.</p>
    <p>Ihre Praxis kann KIM-Nachrichten empfangen und Ihre Praxissoftware unterstützt den Online Check-in bzw. die elektronische Ersatzbescheinigung? Dann erstellen Sie
    jetzt den individuellen QR-Code für Ihre Praxis und stellen Sie diesen für Patienten bereit.
        <div>
            <span class="label">KIM-Adresse:</span><input id="kimaddr" type="text" value="" width="80" title="praxis-dr-baldgesund@kim-dienstleister.kim.telematik" />
            <button onclick="generateQRCode()">QR-Code erzeugen</button>
            <button onclick="clearText()">Löschen</button>&nbsp;&nbsp;&nbsp;
            <button onclick="generatePDF()">PDF erzeugen</button>
        </div>
    </p>

    <p>Geben Sie hier Zusatzinformationen für ihre Patienten ein.
        <div>
            <span class="label">Ihr Praxisname:</span><input id="pname" type="text" value="" width="80" title="Ihr Praxisname" /><br />
            <span class="label">Ihre Praxisadresse:</span><input id="paddress" type="text" value="" width="80" title="Ihre Praxisadresse" />
        </div>
    </p>

    <p>Mehr Informationen zum Online Check-in <a href="www.PKV-Seitenname.de">www.PKV-Seitenname.de</a></p>

    <hr>

    <p>Im Folgenden finden Sie ein Template, für die Erzeugung einer Druckversion des QR-Codes.
        Benutzen Sie dazu den Knopf zum "PDF erzeugen, wenn Sie alle Daten eingegeben und einen QR-Code erstellt haben."
    </p>

    ----8<----8<----8<----8<----8<----8<----8<----8<----8<----8<----

    <div id="ausdruck">
        <h1>Online Check-in für Patienten</h1>
        <p>Sie möchten sich ein E-Rezept ausstellen oder die elektronische Patientenakte befüllen lassen? </p>
        <p>Dann nutzen Sie die Funktion zum Online Check-in in der App Ihrer Versicherung und scannen Sie diesen QR-Code ein</p>
        <p>Folgende Daten werden dabei übertragen:
            <ul>
                <li>Krankenversicherungsnummer (KVNR)</li>
                <li>Name, Vorname</li>
                <li>Adresse</li>
                <li>Zusätzlich bei gesetzlich Versicherten: Versicherungsstatus</li>
            </ul>
        </p>

        <canvas id="qrcode">
            hier wird der QR-Code erzeugt
        </canvas>

        <p>
            Unsere Adresse zu ihrer Kontrolle: <span id="addrcontrol">...</span><br />
            <span id="namecontrol">...</span>
        </p>

        <p><b>Gut zu wissen:</b> Mit dem Online Check-in übermitteln Sie uns nur Ihre in der App angezeigten Basis-Daten. Auf Ihre
        elektronische Patientenakte können wir erst zugreifen, nachdem Sie uns zusätzlich per ePA-App dafür berechtigt haben.
        Weitere Informationen zum Online Check-in erhalten Sie von Ihrer Krankenversicherung und unter
        <a href="www.PKV-Seitenname.de">www.PKV-Seitenname.de</a> .</p>

    </div>

</body>

</html>